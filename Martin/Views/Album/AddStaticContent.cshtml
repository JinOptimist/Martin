@using Martin.Utility
@model Dao.Model.StaticContent

@{
    ViewBag.Title = "Static";
    Layout = "~/Views/AdminMaster.cshtml";
}

@section Script
{
    <script src="@Url.Content("~/Scripts/ckeditor/ckeditor.js")"></script>

    <script>
        var urlGetStaticContent = "@Url.Action("GetStaticContent","Album")";
        function CkEditorReadonly(ckEditor, readonly) {
            ckEditor.document.$.body.disabled = readonly;
            ckEditor.document.$.body.contentEditable = !readonly;
            ckEditor.document.$.designMode = readonly ? "off" : "on";
        }

        function loadStaticConttenc() {
            var typeStaticContent = $("#TypeStaticContent").val();
            var ckEditor = CKEDITOR.instances["Body"];
            CkEditorReadonly(ckEditor, true);

            ckEditor.setData("Wait. Loading...");

            var url = urlGetStaticContent + "?type=" + typeStaticContent;

            $.get(url, function (data) {
                ckEditor.setData(data.body);
                $("#Title").val(data.title);
                CkEditorReadonly(ckEditor, false);
            });
        }

        $(document).ready(function () {
            CKEDITOR.replace('Body');

            CKEDITOR.on('instanceReady', function() {
                 loadStaticConttenc();
            });
            

            $("#TypeStaticContent").change(function () {
                loadStaticConttenc();
            });
        });
    </script>
}

<h2>Static</h2>


@using (Html.BeginForm("AddStaticContent", "Album", FormMethod.Post, new {enctype = "multipart/form-data"}))
{
    <p>
        Заголовок: @Html.TextBoxFor(x => x.Title)
    </p>

    <p>
        Тело @Html.TextAreaFor(x => x.Body)
    </p>

    <p>
        Альбом @Html.DropDownListFor(x => x.TypeStaticContent, StaticContentHelper.SelectList())
    </p>

    <p>
        <input type="submit" value="Сохранить"/>
    </p>
}